#!/bin/bash
# Simple SKILL client implementation using netcat
HOST="$1"
PORT="$2"
OPTION="$3"
FILE="$4"

DEBUG=true

if [ "$OPTION" != "-file" ]; then
    echo "Error: Only -file option is supported"
    exit 1
fi

if [ ! -f "$FILE" ]; then
    echo "Error: File not found: $FILE"
    exit 1
fi

echo "Connecting to $HOST:$PORT..."
echo "Sending file: $FILE"

# Print the file content for debugging
if [ "$DEBUG" = true ]; then
    echo "DEBUG: Sending command:"
    cat "$FILE"
    echo "---"
fi

# Important: Add a newline after the command to ensure proper processing
# We also add a unique marker to recognize the end of transmission
(cat "$FILE"; echo -e "\n__END_OF_COMMAND__\n") | nc -w 30 "$HOST" "$PORT"

# Check the exit status of netcat
if [ $? -ne 0 ]; then
    echo "Error: Failed to connect to SKILL server at $HOST:$PORT"
    exit 1
fi

echo "Command sent successfully."
